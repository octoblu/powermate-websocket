<!DOCTYPE html>
<html lang="en">
<head>
  <title>Powermate Websocket Test</title>
  <style type="text/css">
    html {
      width: 100%;
      height: 100%;
    }

    html, body {
      display: flex;
      flex: 1;
      align-items: center;
      justify-content: center;
      font-family: Helvetica, Arial, sans-serif;
    }

    div {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 2vmin;
    }

    h1 {
      margin: 0;
    }

    p {
      margin: 1vmin;
    }

    pre {
      margin: 0;
      background-color: #ddd;
      padding: 1vmin;
    }

    .error {
      color: red;
    }
  </style>
</head>
<body>
  <div>
    <h1>Powermate Websocket Test</h1>
    <div id="content">
      <p>Please enter the websocket url</p>
      <form>
        <input id="url" name="url" value="ws://localhost:52052" />
        <button type="submit">Connect</button>
      </form>
    </div>
  </div>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
  <script type="text/javascript">
    function onError(error) {
      console.error(error)
      $('#content').html('<h4 class="error">An Error occured. Check JS console for more info.</h4>')
    }

    function onMessage(message) {
      $('#messages').append(message.data + '\n')
    }

    function onOpen() {
      $('#content').html('<pre id="messages"></pre>')
    }

    function onSubmit($event) {
      $event.preventDefault()
      const socket = new WebSocket($('#url').val())
      $('#content').html('<img src="ripple.svg" alt="loading"/>')
      socket.addEventListener('open', onOpen)
      socket.addEventListener('message', onMessage)
      socket.addEventListener('error', onError)
    }

    $(function(){
      $('form').on('submit', onSubmit)
    })
  </script>
</body>
</html>
